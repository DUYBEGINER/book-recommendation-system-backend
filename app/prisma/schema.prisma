generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model authors {
  author_id    BigInt         @id @default(autoincrement())
  author_name  String         @db.VarChar(100)
  biography    String?
  book_authors book_authors[]
}

model book_authors {
  book_id   BigInt
  author_id BigInt
  authors   authors @relation(fields: [author_id], references: [author_id], onDelete: NoAction, onUpdate: NoAction)
  books     books   @relation(fields: [book_id], references: [book_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([book_id, author_id])
}

model book_formats {
  format_id    BigInt     @id @default(autoincrement())
  book_id      BigInt
  type_id      BigInt
  content_url  String     @db.VarChar(255)
  total_pages  Int?
  file_size_kb Int?
  books        books      @relation(fields: [book_id], references: [book_id], onDelete: NoAction, onUpdate: NoAction)
  book_types   book_types @relation(fields: [type_id], references: [type_id], onDelete: NoAction, onUpdate: NoAction)
}

model book_genres {
  book_id  BigInt
  genre_id BigInt
  books    books  @relation(fields: [book_id], references: [book_id], onDelete: NoAction, onUpdate: NoAction)
  genres   genres @relation(fields: [genre_id], references: [genre_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([book_id, genre_id])
}

model book_types {
  type_id      BigInt         @id @default(autoincrement())
  type_name    String         @unique @db.VarChar(20)
  book_formats book_formats[]
}

model bookmarks {
  bookmark_id      BigInt   @id @default(autoincrement())
  user_id          BigInt
  book_id          BigInt
  page_number      Int?
  location_in_book String?  @db.VarChar(255)
  created_at       DateTime @default(now()) @db.Timestamp(6)
  note             String?  @db.VarChar(255)
  books            books    @relation(fields: [book_id], references: [book_id], onDelete: NoAction, onUpdate: NoAction)
  users            users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model books {
  book_id          BigInt            @id @default(autoincrement())
  title            String            @db.VarChar(255)
  description      String
  cover_image_url  String            @db.VarChar(255)
  publication_year Int?
  publisher        String?           @db.VarChar(100)
  created_at       DateTime          @default(now()) @db.Timestamp(6)
  updated_at       DateTime?         @db.Timestamp(6)
  is_deleted       Boolean?          @default(false)
  book_authors     book_authors[]
  book_formats     book_formats[]
  book_genres      book_genres[]
  bookmarks        bookmarks[]
  favorites        favorites[]
  ratings          ratings[]
  reading_history  reading_history[]
}

model favorites {
  favorite_id BigInt   @id @default(autoincrement())
  user_id     BigInt
  book_id     BigInt
  added_at    DateTime @default(now()) @db.Timestamp(6)
  books       books    @relation(fields: [book_id], references: [book_id], onDelete: NoAction, onUpdate: NoAction)
  users       users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model genres {
  genre_id    BigInt        @id @default(autoincrement())
  genre_name  String        @unique @db.VarChar(50)
  description String?
  book_genres book_genres[]
}

model ratings {
  rating_id    BigInt   @id @default(autoincrement())
  user_id      BigInt
  book_id      BigInt
  rating_value Int
  comment      String?
  created_at   DateTime @default(now()) @db.Timestamp(6)
  books        books    @relation(fields: [book_id], references: [book_id], onDelete: NoAction, onUpdate: NoAction)
  users        users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model reading_history {
  history_id   BigInt   @id @default(autoincrement())
  user_id      BigInt
  book_id      BigInt
  last_read_at DateTime @default(now()) @db.Timestamp(6)
  progress     Float?
  books        books    @relation(fields: [book_id], references: [book_id], onDelete: NoAction, onUpdate: NoAction)
  users        users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model roles {
  role_id   BigInt  @id @default(autoincrement())
  role_name String  @unique @db.VarChar(20)
  users     users[]
}

model users {
  user_id                         BigInt            @id @default(autoincrement())
  role_id                         BigInt
  username                        String            @unique @db.VarChar(50)
  password                        String            @db.VarChar(255)
  email                           String            @unique @db.VarChar(100)
  phone_number                    String?           @unique @db.VarChar(15)
  avatar_url                      String?           @db.VarChar(255)
  is_activate                     Boolean           @default(false)
  full_name                       String?           @db.VarChar(100)
  is_ban                          Boolean           @default(false)
  created_at                      DateTime          @default(now()) @db.Timestamp(6)
  updated_at                      DateTime?         @db.Timestamp(6)
  email_verification_token        String?           @db.VarChar(255)
  email_verification_token_expiry DateTime?         @db.Timestamp(6)
  reset_password_token            String?           @db.VarChar(255)
  reset_password_token_expiry     DateTime?         @db.Timestamp(6)
  bookmarks                       bookmarks[]
  favorites                       favorites[]
  ratings                         ratings[]
  reading_history                 reading_history[]
  roles                           roles             @relation(fields: [role_id], references: [role_id], onDelete: NoAction, onUpdate: NoAction)
}
